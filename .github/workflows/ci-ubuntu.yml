name: CI - Ubuntu

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Ubuntu Tests
    runs-on: ubuntu-latest
    permissions:
      contents: read
    timeout-minutes: 10

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Install Bats
        run: sudo apt-get update && sudo apt-get install -y bats

      - name: Run tests
        run: |
          # Run tests without coverage for Ubuntu (sub-environment, coverage measured on macOS)
          # Note: install/ubuntu/ is excluded as it's currently a stub implementation
          bats install/common/ tests/files/

  shellcheck:
    name: ShellCheck and shfmt
    runs-on: ubuntu-latest
    permissions:
      contents: read
    timeout-minutes: 10

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Run ShellCheck and shfmt
        uses: ./.github/actions/shellcheck-shfmt
        with:
          os: ubuntu
